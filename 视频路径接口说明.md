# 视频路径接口说明

## 概述

这是一个独立的开放HTTP接口，专门用于根据输入路径返回MP4视频文件的路径信息。**无需登录即可调用**，与项目的其他功能完全独立。

## 接口地址

- **基础URL**: `http://127.0.0.1:5503`
- **接口路径**: `/api/video/paths`
- **请求方法**: `GET`

## 接口特性

### ✅ **完全独立**
- 不依赖项目的其他功能
- 不依赖用户认证
- 不依赖下载状态
- 纯文件系统搜索功能

### ✅ **功能完整**
- 支持递归搜索子目录
- 支持多种排序方式
- 支持分页查询
- 返回详细的文件信息

### ✅ **错误处理**
- 完整的参数验证
- 友好的错误提示
- 适当的HTTP状态码

## 请求参数

### 必填参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| `path` | string | 要搜索的文件路径（绝对路径或相对路径） |

### 可选参数

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `recursive` | boolean | false | 是否递归搜索子目录 |
| `limit` | integer | 100 | 返回数量限制，最大1000 |
| `offset` | integer | 0 | 偏移量，用于分页 |
| `sort_by` | string | "name" | 排序方式：name/size/date |
| `sort_order` | string | "asc" | 排序顺序：asc/desc |

## 使用示例

### 1. 基本搜索
```bash
# 搜索指定路径下的MP4文件
curl "http://127.0.0.1:5503/api/video/paths?path=/home/ec2-user/media"

# 搜索用户主目录
curl "http://127.0.0.1:5503/api/video/paths?path=/home/ec2-user"

# 搜索临时目录
curl "http://127.0.0.1:5503/api/video/paths?path=/tmp"
```

### 2. 递归搜索
```bash
# 递归搜索所有子目录
curl "http://127.0.0.1:5503/api/video/paths?path=/home/ec2-user/media&recursive=true"

# 递归搜索并限制数量
curl "http://127.0.0.1:5503/api/video/paths?path=/home/ec2-user/media&recursive=true&limit=50"
```

### 3. 排序搜索
```bash
# 按文件大小排序，获取最大的文件
curl "http://127.0.0.1:5503/api/video/paths?path=/home/ec2-user/media&recursive=true&sort_by=size&sort_order=desc&limit=5"

# 按修改时间排序，获取最新的文件
curl "http://127.0.0.1:5503/api/video/paths?path=/home/ec2-user/media&recursive=true&sort_by=date&sort_order=desc&limit=5"

# 按文件名排序
curl "http://127.0.0.1:5503/api/video/paths?path=/home/ec2-user/media&sort_by=name&sort_order=asc"
```

### 4. 分页查询
```bash
# 第1页，每页10个文件
curl "http://127.0.0.1:5503/api/video/paths?path=/home/ec2-user/media&recursive=true&limit=10&offset=0"

# 第2页，每页10个文件
curl "http://127.0.0.1:5503/api/video/paths?path=/home/ec2-user/media&recursive=true&limit=10&offset=10"

# 第3页，每页20个文件
curl "http://127.0.0.1:5503/api/video/paths?path=/home/ec2-user/media&recursive=true&limit=20&offset=40"
```

## 响应格式

### 成功响应

```json
{
    "success": true,
    "data": {
        "search_path": "/home/ec2-user/media",
        "search_options": {
            "recursive": true,
            "sort_by": "size",
            "sort_order": "desc"
        },
        "files": [
            {
                "filename": "sample_video.mp4",
                "file_path": "/home/ec2-user/media/videos/sample_video.mp4",
                "relative_path": "videos/sample_video.mp4",
                "file_size": 104857600,
                "file_size_formatted": "100.0MB",
                "modified_time": 1692182400,
                "modified_time_formatted": "2023-08-18 12:00:00",
                "directory": "/home/ec2-user/media/videos"
            }
        ],
        "pagination": {
            "total": 25,
            "limit": 10,
            "offset": 0,
            "has_more": true
        },
        "statistics": {
            "total_files": 25,
            "total_size": 2621440000,
            "total_size_formatted": "2.44GB",
            "average_size": 104857600,
            "average_size_formatted": "100.0MB"
        }
    },
    "message": "成功找到 25 个MP4文件"
}
```

### 错误响应

#### 400 Bad Request - 缺少必填参数
```json
{
    "success": false,
    "error": "缺少必填参数: path",
    "message": "请提供文件路径参数"
}
```

#### 404 Not Found - 路径不存在
```json
{
    "success": false,
    "error": "路径不存在: /nonexistent/path",
    "message": "提供的文件路径不存在"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
    "success": false,
    "error": "无法读取目录: Permission denied",
    "message": "获取MP4文件列表失败"
}
```

## 数据字段说明

### 文件信息字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `filename` | string | 文件名 |
| `file_path` | string | 完整文件路径 |
| `relative_path` | string | 相对于搜索路径的相对路径 |
| `file_size` | integer | 文件大小（字节） |
| `file_size_formatted` | string | 格式化的文件大小 |
| `modified_time` | integer | 修改时间（Unix时间戳） |
| `modified_time_formatted` | string | 格式化的修改时间 |
| `directory` | string | 文件所在目录 |

### 分页信息字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `total` | integer | 总记录数 |
| `limit` | integer | 每页记录数 |
| `offset` | integer | 当前偏移量 |
| `has_more` | boolean | 是否有更多数据 |

### 统计信息字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `total_files` | integer | 总文件数 |
| `total_size` | integer | 总大小（字节） |
| `total_size_formatted` | string | 格式化的总大小 |
| `average_size` | float | 平均文件大小 |
| `average_size_formatted` | string | 格式化的平均大小 |

## 使用场景

### 1. 文件管理系统
```bash
# 获取指定目录下的所有MP4文件
curl "http://127.0.0.1:5503/api/video/paths?path=/media/videos&recursive=true"
```

### 2. 媒体库管理
```bash
# 按大小排序，找出最大的视频文件
curl "http://127.0.0.1:5503/api/video/paths?path=/media/videos&recursive=true&sort_by=size&sort_order=desc&limit=10"
```

### 3. 备份系统
```bash
# 获取最近修改的视频文件
curl "http://127.0.0.1:5503/api/video/paths?path=/backup/videos&recursive=true&sort_by=date&sort_order=desc&limit=100"
```

### 4. 内容分析
```bash
# 分析视频文件分布
curl "http://127.0.0.1:5503/api/video/paths?path=/content&recursive=true&limit=1000"
```

## 注意事项

### 1. 路径要求
- 必须是有效的文件系统路径
- 路径必须是目录，不能是文件
- 确保有读取权限

### 2. 性能考虑
- 递归搜索大量目录可能较慢
- 建议合理使用`limit`参数
- 大量文件时使用分页

### 3. 安全考虑
- 接口会暴露文件系统信息
- 建议在生产环境中限制访问路径
- 避免暴露敏感目录

### 4. 错误处理
- 始终检查响应状态码
- 处理可能的网络错误
- 验证返回数据的完整性

## 测试工具

项目提供了完整的测试脚本：

```bash
# 运行测试脚本
python3 test_video_paths_api.py

# 手动测试特定查询
curl "http://127.0.0.1:5503/api/video/paths?path=/home/ec2-user/media&recursive=true&limit=5"
```

## 更新日志

### v1.0.0
- ✅ 基础MP4文件搜索功能
- ✅ 递归搜索支持
- ✅ 多种排序方式
- ✅ 分页功能
- ✅ 详细的文件信息
- ✅ 统计信息
- ✅ 完整的错误处理
- ✅ 无需认证的开放接口
- ✅ 完全独立的功能模块

## 总结

这个接口提供了一个简单、高效、独立的方式来搜索和获取MP4视频文件的路径信息。它不依赖项目的其他功能，可以单独使用，非常适合需要文件系统搜索功能的场景。

主要优势：
1. **独立性**：完全独立，不依赖其他功能
2. **易用性**：简单的HTTP GET请求
3. **功能性**：支持多种搜索和排序选项
4. **可靠性**：完整的错误处理和参数验证
5. **开放性**：无需认证，直接调用 